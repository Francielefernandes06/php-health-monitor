# InstalaÃ§Ã£o no Laravel

## InstalaÃ§Ã£o

### 1. Instalar via Composer

```bash
composer require phphealth/monitor
```

### 2. Publicar ConfiguraÃ§Ã£o (Opcional)

```bash
php artisan vendor:publish --tag=health-monitor-config
```

Ou use o comando de instalaÃ§Ã£o:

```bash
php artisan health-monitor:install
```

### 3. Configurar (Opcional)

Edite `config/health-monitor.php` conforme necessÃ¡rio:

```php
return [
    'enabled' => env('HEALTH_MONITOR_ENABLED', true),
    
    'storage' => [
        'driver' => 'sqlite',
        'database_path' => storage_path('health-monitor/monitor.db'),
    ],
    
    'collectors' => [
        'request' => [
            'enabled' => true,
            'slow_threshold' => 1000, // ms
            'ignore_routes' => [
                'health-monitor/*',
                'horizon/*',
                'telescope/*',
            ],
        ],
        'database' => [
            'enabled' => true,
            'slow_query_threshold' => 100, // ms
        ],
    ],
    
    'dashboard' => [
        'enabled' => true,
        'path' => '/health-monitor',
        'auth' => [
            'enabled' => true,
            'username' => env('HEALTH_MONITOR_USERNAME', 'admin'),
            'password' => env('HEALTH_MONITOR_PASSWORD', 'admin'),
        ],
    ],
];
```

### 4. Configurar VariÃ¡veis de Ambiente

Adicione ao `.env`:

```env
HEALTH_MONITOR_ENABLED=true
HEALTH_MONITOR_USERNAME=admin
HEALTH_MONITOR_PASSWORD=sua-senha-segura
```

## Uso

### Acesso ao Dashboard

Acesse: `http://seu-app.test/health-monitor`

Credenciais padrÃ£o:
- **UsuÃ¡rio:** admin
- **Senha:** admin (altere imediatamente!)

### Comandos Artisan

```bash
# Ver status
php artisan health-monitor:status

# Limpar dados antigos
php artisan health-monitor:cleanup --days=7

# Instalar/configurar
php artisan health-monitor:install
```

### Usar no CÃ³digo

```php
use PHPHealth\Monitor\Integrations\Laravel\Facades\HealthMonitor;

// Acessar o monitor
$monitor = app(\PHPHealth\Monitor\Monitor::class);

// Ou via facade
HealthMonitor::getStorage()->retrieve();

// Adicionar contexto
$collector = HealthMonitor::getCollector('request');
```

## Monitoramento AutomÃ¡tico

O monitor captura automaticamente:

âœ… **RequisiÃ§Ãµes HTTP**
- Tempo de resposta
- Uso de memÃ³ria
- Status codes
- URIs

âœ… **Queries do Eloquent**
- SQL executado
- Tempo de execuÃ§Ã£o
- DetecÃ§Ã£o de queries lentas

âœ… **Erros e ExceÃ§Ãµes**
- Stack traces
- Contexto completo

## Ignorar Rotas

Para ignorar certas rotas do monitoramento:

```php
// config/health-monitor.php
'collectors' => [
    'request' => [
        'ignore_routes' => [
            'health-monitor/*',
            'api/webhooks/*',
            '_debugbar/*',
        ],
    ],
],
```

## Desabilitar em Ambientes EspecÃ­ficos

```php
// config/health-monitor.php
'enabled' => env('HEALTH_MONITOR_ENABLED', !app()->environment('testing')),
```

Ou no `.env`:

```env
# Desabilitar em local
HEALTH_MONITOR_ENABLED=false
```

## Middleware Manual (Opcional)

Se preferir controle manual do middleware:

```php
// app/Http/Kernel.php
protected $middlewareGroups = [
    'web' => [
        // ... outros middlewares
        \PHPHealth\Monitor\Integrations\Laravel\Middleware\MonitorRequests::class,
    ],
];
```

## Usando com MySQL

```php
// config/health-monitor.php
'storage' => [
    'driver' => 'mysql',
    'connection' => [
        'host' => env('DB_HOST', '127.0.0.1'),
        'port' => env('DB_PORT', '3306'),
        'database' => env('DB_DATABASE', 'health_monitor'),
        'username' => env('DB_USERNAME', 'root'),
        'password' => env('DB_PASSWORD', ''),
    ],
],
```

## Troubleshooting

### ServiceProvider nÃ£o encontrado

Se receber erro sobre ServiceProvider nÃ£o encontrado:

```bash
composer dump-autoload
php artisan config:clear
php artisan cache:clear
```

### Dashboard nÃ£o carrega

Verifique:
1. `config/health-monitor.php` existe
2. `'dashboard.enabled' => true`
3. Rota nÃ£o estÃ¡ em conflito

### Queries nÃ£o aparecem

Certifique-se que:
1. `'collectors.database.enabled' => true`
2. Usando conexÃµes do Laravel (DB facade ou Eloquent)
3. Middleware estÃ¡ ativo

## Performance

O monitor adiciona overhead mÃ­nimo:
- ~2-5ms por requisiÃ§Ã£o
- ~10MB memÃ³ria adicional

Para alto trÃ¡fego, considere:

```php
'performance' => [
    'sampling_rate' => 10, // Monitorar apenas 10%
],
```

## PrÃ³ximos Passos

- Configure alertas (em breve)
- Explore o dashboard
- Otimize queries lentas identificadas
- Configure cleanup automÃ¡tico

## Suporte

- ğŸ“– [DocumentaÃ§Ã£o Completa](https://github.com/Francielefernandes06/php-health-monitor)
- ğŸ› [Reportar Bug](https://github.com/Francielefernandes06/php-health-monitor/issues)
- ğŸ’¬ [DiscussÃµes](https://github.com/Francielefernandes06/php-health-monitor/discussions)